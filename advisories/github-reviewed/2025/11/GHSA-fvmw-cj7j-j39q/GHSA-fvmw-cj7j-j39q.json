{
  "schema_version": "1.4.0",
  "id": "GHSA-fvmw-cj7j-j39q",
  "modified": "2025-11-20T18:25:45Z",
  "published": "2025-11-19T20:09:12Z",
  "aliases": [
    "CVE-2025-65019"
  ],
  "summary": "Astro Cloudflare adapter has Stored Cross Site Scripting vulnerability in /_image endpoint",
  "details": "## Summary\n\nWhen using Astro's Cloudflare adapter (@astrojs/cloudflare) with `output: 'server'`, the image optimization endpoint (`/_image`) contains a critical vulnerability in the `isRemoteAllowed()` function that unconditionally allows `data:` protocol URLs. This enables Cross-Site Scripting (XSS) attacks through malicious SVG payloads, bypassing domain restrictions and Content Security Policy protections.\n\n## Details\n\nOn-demand rendered sites built with Astro include an `/_image` endpoint for image optimization. While this endpoint is designed to restrict processing to local images and authorized remote domains (configured via `image.domains` or `image.remotePatterns`), a critical vulnerability exists in the underlying validation logic.\n\nThe `isRemoteAllowed()` function in [packages/internal-helpers/src/remote.ts](https://github.com/withastro/astro/blob/b8ca69b97149becefaf89bf21853de9c905cdbb7/packages/internal-helpers/src/remote.ts) (lines 128-131) unconditionally allows ALL `data:` protocol URLs without any validation or sanitization. When combined with SVG images containing JavaScript, this creates a vector for XSS attacks.\n\n**Vulnerable Code:**\n```JavaScript\n/packages/ packages/internal-helpers/src/remote.ts lines 128-131\nif (url.protocol === 'data:') {\n    return true;  // ‚Üê Unconditionally allows ALL data: URLs!\n}\n```\n\nThe vulnerability manifests differently depending on the image endpoint implementation:\n- **Safe implementation**: Server processes SVG and converts to raster format (PNG/JPEG), removing JavaScript\n- **Vulnerable implementation**: Server redirects browser to raw SVG data URL, allowing JavaScript execution\n\n### PoC\n1. Create a new minimal Astro project (astro@latest)\n\n2. Configure it to use the Cloudflare adapter (@astrojs/cloudflare@12.6.10) \n\n3. Deploy to Cloudflare Pages or Workers.\n\n4. Write page to load SVG Image like : [SVG XSS Payload](https://gist.github.com/rudSarkar/76f1ce7a65c356a5cd71d058ab76a344)\n\n5. Open directly the SVG file to show an alert (in read scenarios, the apps that use the framework will use CDN for example, to load SVG, depending that the framework is secure)\n\n\n### Impact\n1. **XSS**: Malicious URLs can be crafted to execute JavaScript in victim's browser\n2. **Session Hijacking**: JavaScript can access cookies and session tokens\n3. **Account Takeover**: Combined with CSRF, can perform unauthorized actions\n4. **Data Exfiltration**: Sensitive information can be stolen and sent to attacker-controlled servers\n\n### References\n-  **Vulnerable Function**:  [packages/internal-helpers/src/remote.ts](https://github.com/withastro/astro/blob/b8ca69b97149becefaf89bf21853de9c905cdbb7/packages/internal-helpers/src/remote.ts) lines 128-131\n- **Similar Vulnerability**:: https://dailycve.com/wordpress-stored-xss-via-svg-upload-cve-2025-2575-medium/",
  "severity": [
    {
      "type": "CVSS_V3",
      "score": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N"
    }
  ],
  "affected": [
    {
      "package": {
        "ecosystem": "npm",
        "name": "astro"
      },
      "ranges": [
        {
          "type": "ECOSYSTEM",
          "events": [
            {
              "introduced": "0"
            },
            {
              "fixed": "5.15.9"
            }
          ]
        }
      ]
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/withastro/astro/security/advisories/GHSA-fvmw-cj7j-j39q"
    },
    {
      "type": "ADVISORY",
      "url": "https://nvd.nist.gov/vuln/detail/CVE-2025-65019"
    },
    {
      "type": "WEB",
      "url": "https://github.com/withastro/astro/commit/9e9c528191b6f5e06db9daf6ad26b8f68016e533"
    },
    {
      "type": "PACKAGE",
      "url": "https://github.com/withastro/astro"
    }
  ],
  "database_specific": {
    "cwe_ids": [
      "CWE-79"
    ],
    "severity": "MODERATE",
    "github_reviewed": true,
    "github_reviewed_at": "2025-11-19T20:09:12Z",
    "nvd_published_at": "2025-11-19T17:15:53Z"
  }
}